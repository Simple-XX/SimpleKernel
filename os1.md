# 对操作系统整体介绍

#### 关于本项目

本项目提供一个简单的操作系统内核，主要是用于初学者的学习，同时也提供了一套文档来辅助理解，希望各位初学者能够从中学到很多，如果有什么问题可以在github中提issue，届时会有开发者帮忙解答，希望能够在我们的帮助下让初学者能够更快的理解操作系统的机制，为开源社区做出一丝贡献

#### 操作系统概览

作为一个初学者走过来的我，我也非常理解一个初学者对于操作系统的懵懂感觉。在最早时候，对于操作系统的认知只是停留在windows上，后来慢慢才知道，原来还有macOS和linux，这些是不同的操作系统，这些操作系统上的软件不能相互通过拷贝可执行文件来进行运行，后来才知道这是因为不同操作系统所使用编译器以及内存分配以及系统调用API等不一样（这句话可以不用理解），这算是最初我学操作系统之前一个最直观的理解。再后来学了一些嵌入式开发后才发现，原来像C51单片机这种是不需要操作系统就能运行的，他的机制是通过用Keil等IDE将代码在PC端编译好，然后把二进制直接烧录到单片机上，但是玩过单片机的都知道，一个程序如果太庞大，就会有很多细节地方都需要管理，比如同时有多个进程运行，或者有很多变量需要进行分配，会占用大量内存或者寄存器资源等，而且不同厂商的硬件开发商都会出不同型号的开发板，比如ARM和x86开发板就会有很多细节不同，这种问题会令开发者非常苦恼，开发者的大脑又不能像计算机一样能够记住所有的东西，所以自然而然的就需要一个软件能够希望来管理这些硬件资源，让我们写的代码更好的去运行在电脑上面，所以操作系统就是这样一步步的诞生的。所以，用一句话总结操作系统要做的事情，就是用来更方便的管理硬件资源，让开发者和使用者更方便的使用，对底层进行封装抽象，就像汽车的封装一样。



下面主要从操作系统启动简要介绍下一个启动流程，一个操作系统的启动要从开关机开始，这里我们就要从开关机过程讲起，硬核的来了

主要是分为以下几个阶段：

1. BIOS ：主要是开机自检，计算机硬件能否满足运行的基本条件，这叫做"硬件自检"（Power-On Self-Test），缩写为[POST](http://en.wikipedia.org/wiki/Power-on_self-test)。 然后BIOS把控制权转交给下一阶段的启动程序，也就是读取主引导记录。这里解释一下，BIOS并不知道具体需要怎样加载操作系统（这很正常，不同的操作系统有不同的加载方式），于是BIOS规定：任何安装在磁盘中的操作系统，必需在磁盘的第0扇区存放一段引导代码，BIOS只把这一段引导代码加载到内存中执行，而具体应该如何加载整个操作系统，由操作系统的编写人员自行在引导代码中定义。

   

2. 主引导记录 ：这时，BIOS需要知道，"下一阶段的启动程序"具体存放在哪一个设备。也就是说，BIOS需要有一个外部储存设备的排序，排在前面的设备就是优先转交控制权的设备。这种排序叫做"启动顺序"（Boot Sequence）。 BIOS按照"启动顺序"，把控制权转交给排在第一位的储存设备。

   这时，计算机读取该设备的第一个扇区，也就是读取最前面的512个字节。如果这512个字节的最后两个字节是0x55和0xAA，表明这个设备可以用于启动；如果不是，表明设备不能用于启动，控制权于是被转交给"启动顺序"中的下一个设备。

   这最前面的512个字节，就叫做["主引导记录"](http://en.wikipedia.org/wiki/Master_boot_record)（Master boot record，缩写为MBR）。

   "主引导记录"只有512个字节，放不了太多东西。它的主要作用是，告诉计算机到硬盘的哪一个位置去找操作系统。

3. 硬盘启动  这时，计算机的控制权就要转交给硬盘的某个分区了，这里又分成三种情况。

   情况A：卷引导记录：

   情况B：扩展分区和逻辑分区

   情况C：启动管理器 ：在这种情况下，计算机读取"主引导记录"前面446字节的机器码之后，不再把控制权转交给某一个分区，而是运行事先安装的["启动管理器"](http://en.wikipedia.org/wiki/Boot_loader#Modern_boot_loaders)（boot loader），由用户选择启动哪一个操作系统。

4. 转交至操作系统：控制权转交给操作系统后，操作系统的内核首先被载入内存。以Linux系统为例，先载入/boot目录下面的kernel。内核加载成功后，第一个运行的程序是/sbin/init。它根据配置文件（Debian系统是/etc/initab）产生init进程。这是Linux启动后的第一个进程，pid进程编号为1，其他进程都是它的后代。

   然后，init线程加载系统的各个模块，比如窗口程序和网络程序，直至执行/bin/login程序，跳出登录界面，等待用户输入用户名和密码。

   至此，全部启动过程完成。





参考：

https://chyyuu.gitbooks.io/ucore_os_docs/content/lab0/lab0_2_1_about_labs.html

http://www.ruanyifeng.com/blog/2013/02/booting.html

Linux系统启动过程分析 讲解grub过程 https://www.cnblogs.com/bluestorm/p/5981435.html

linux0.11启动过程 https://www.jianshu.com/p/0e42edc5891d

http://bbs.chinaunix.net/thread-2046548-1-1.html

https://blog.51cto.com/dongdiy/366909

http://roclinux.cn/?p=1301

















